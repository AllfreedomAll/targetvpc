# TargetVPC - æœåŠ¡å™¨ç›‘æ§ä»£ç†

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104.1+-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

TargetVPC æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æœåŠ¡å™¨ç›‘æ§ä»£ç†ç³»ç»Ÿï¼Œä¸“ä¸ºåˆ†å¸ƒå¼ç¯å¢ƒè®¾è®¡ã€‚å®ƒèƒ½å¤Ÿå®æ—¶æ”¶é›†æœåŠ¡å™¨å…³é”®æŒ‡æ ‡ï¼Œæ”¯æŒå¤šç§å‘Šè­¦é€šçŸ¥æ–¹å¼ï¼Œå¹¶æä¾›çµæ´»çš„é…ç½®ç®¡ç†å’Œæ•°æ®æŸ¥è¯¢APIã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š ç³»ç»Ÿç›‘æ§
- **CPUä½¿ç”¨ç‡ç›‘æ§** - å®æ—¶ç›‘æ§CPUä½¿ç”¨æƒ…å†µ
- **å†…å­˜ä½¿ç”¨ç‡ç›‘æ§** - ç›‘æ§å†…å­˜å ç”¨å’Œå¯ç”¨æ€§
- **ç£ç›˜ä½¿ç”¨ç‡ç›‘æ§** - ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- **å¯é…ç½®çš„ç›‘æ§é—´éš”** - æ”¯æŒè‡ªå®šä¹‰æ•°æ®æ”¶é›†é¢‘ç‡

### ğŸ”” æ™ºèƒ½å‘Šè­¦
- **å¤šé€šé“å‘Šè­¦æ”¯æŒ**
  - ğŸ“§ é‚®ä»¶å‘Šè­¦
  - ğŸš€ é£ä¹¦æœºå™¨äººå‘Šè­¦
  - ğŸ”” é’‰é’‰æœºå™¨äººå‘Šè­¦
- **é˜ˆå€¼å‘Šè­¦** - æ”¯æŒ >, >=, <, <= ç­‰æ“ä½œç¬¦
- **å‘Šè­¦å†·å´æœºåˆ¶** - é˜²æ­¢å‘Šè­¦é£æš´
- **å‘Šè­¦è®°å½•ä¸ŠæŠ¥** - è‡ªåŠ¨å‘ç®¡ç†ç«¯ä¸ŠæŠ¥å‘Šè­¦ä¿¡æ¯

### âš™ï¸ é…ç½®ç®¡ç†
- **åŠ¨æ€é…ç½®åŒæ­¥** - ä»ç®¡ç†ç«¯è‡ªåŠ¨è·å–æœ€æ–°é…ç½®
- **IPè‡ªåŠ¨è¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«æœåŠ¡å™¨IPåœ°å€
- **é…ç½®çƒ­æ›´æ–°** - æ— éœ€é‡å¯å³å¯åº”ç”¨æ–°é…ç½®

### ğŸŒ APIæ¥å£
- **RESTful API** - åŸºäºFastAPIæ„å»º
- **æŒ‡æ ‡æ•°æ®æŸ¥è¯¢** - æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢
- **å¥åº·æ£€æŸ¥æ¥å£** - ç³»ç»ŸçŠ¶æ€ç›‘æ§
- **é…ç½®æŸ¥è¯¢æ¥å£** - è·å–å½“å‰é…ç½®ä¿¡æ¯

### ğŸ—„ï¸ æ•°æ®å­˜å‚¨
- **Rediså­˜å‚¨** - é«˜æ€§èƒ½å†…å­˜æ•°æ®åº“
- **æ•°æ®ä¿ç•™ç­–ç•¥** - å¯é…ç½®çš„æ•°æ®ä¿ç•™æ—¶é—´
- **æ—¶é—´åºåˆ—æ•°æ®** - æ”¯æŒå†å²æ•°æ®æŸ¥è¯¢

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç®¡ç†ç«¯Admin   â”‚    â”‚   TargetVPC     â”‚    â”‚   å‘Šè­¦é€šé“      â”‚
â”‚                 â”‚â—„â”€â”€â–ºâ”‚                 â”‚â”€â”€â”€â–ºâ”‚                 â”‚
â”‚ - é…ç½®ç®¡ç†      â”‚    â”‚ - æŒ‡æ ‡æ”¶é›†      â”‚    â”‚ - é‚®ä»¶         â”‚
â”‚ - å‘Šè­¦è®°å½•      â”‚    â”‚ - é˜ˆå€¼æ£€æŸ¥      â”‚    â”‚ - é£ä¹¦         â”‚
â”‚ - æ•°æ®æŸ¥è¯¢      â”‚    â”‚ - å‘Šè­¦å‘é€      â”‚    â”‚ - é’‰é’‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚     Redis       â”‚
                       â”‚                 â”‚
                       â”‚ - æŒ‡æ ‡å­˜å‚¨      â”‚
                       â”‚ - é…ç½®ç¼“å­˜      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **Python**: 3.11+
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows
- **å†…å­˜**: è‡³å°‘ 512MB RAM
- **ç£ç›˜**: è‡³å°‘ 100MB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: éœ€è¦ç½‘ç»œè¿æ¥ä»¥è®¿é—®ç®¡ç†ç«¯å’Œå‘Šè­¦æœåŠ¡

## ğŸ› ï¸ å®‰è£…éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šDockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd targetvpc
```

2. **å¯åŠ¨æœåŠ¡**
```bash
docker-compose up -d
```

3. **éªŒè¯éƒ¨ç½²**
```bash
curl http://localhost:8001/health
```

### æ–¹å¼äºŒï¼šæœ¬åœ°å®‰è£…

1. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate     # Windows
```

2. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **é…ç½®Redis**
```bash
# å¯åŠ¨RedisæœåŠ¡
redis-server

# æˆ–ä½¿ç”¨Docker
docker run -d -p 6379:6379 redis:7-alpine
```

4. **å¯åŠ¨æœåŠ¡**
```bash
python -m src.main
```

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ä½ç½®
- ä¸»é…ç½®æ–‡ä»¶: `config/default.json`
- ç¯å¢ƒå˜é‡: æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®

### é…ç½®é¡¹è¯´æ˜

```json
{
    "redis": {
        "host": "localhost",        // Redisä¸»æœºåœ°å€
        "port": 6379,              // Redisç«¯å£
        "db": 0,                   // Redisæ•°æ®åº“ç¼–å·
        "password": null           // Rediså¯†ç ï¼ˆå¯é€‰ï¼‰
    },
    "admin": {
        "base_url": "http://localhost:8000",           // ç®¡ç†ç«¯åŸºç¡€URL
        "config_endpoint": "/api/servers/config/",     // é…ç½®è·å–æ¥å£
        "alert_endpoint": "/api/alert-records/report/" // å‘Šè­¦ä¸ŠæŠ¥æ¥å£
    },
    "metrics": {
        "collection_interval": 10,  // æŒ‡æ ‡æ”¶é›†é—´éš”ï¼ˆç§’ï¼‰
        "retention_days": 7         // æ•°æ®ä¿ç•™å¤©æ•°
    },
    "alerts": {
        "cooldown_minutes": 5       // å‘Šè­¦å†·å´æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
    },
    "server": {
        "host": "0.0.0.0",         // æœåŠ¡ç›‘å¬åœ°å€
        "port": 8001               // æœåŠ¡ç›‘å¬ç«¯å£
    }
}
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# Redisé…ç½®
export REDIS_HOST=your-redis-host
export REDIS_PORT=6379
export REDIS_PASSWORD=your-password

# ç®¡ç†ç«¯é…ç½®
export ADMIN_BASE_URL=http://your-admin-server:8000

# æœåŠ¡é…ç½®
export SERVER_HOST=0.0.0.0
export SERVER_PORT=8001
```

## ğŸ“¡ APIæ¥å£

### å¥åº·æ£€æŸ¥
```http
GET /health
```

### è·å–é…ç½®
```http
GET /api/config
Headers: X-Client-IP: <client-ip>
```

### æŸ¥è¯¢æŒ‡æ ‡æ•°æ®
```http
POST /api/metrics
Content-Type: application/json

{
    "start_time": "2024-01-01T00:00:00Z",
    "end_time": "2024-01-01T23:59:59Z",
    "indexes": ["cpu", "memory", "disk"]
}
```

### ä¸ŠæŠ¥å‘Šè­¦
```http
POST /api/alert
Content-Type: application/json

{
    "index": "cpu",
    "threshold": 80.0,
    "current_value": 85.0,
    "timestamp": 1704067200
}
```

## ğŸ”§ å‘Šè­¦é…ç½®

### é£ä¹¦æœºå™¨äººé…ç½®
```json
{
    "type": "feishu",
    "webhook_url": "https://open.feishu.cn/open-apis/bot/v2/hook/YOUR_TOKEN",
    "enabled": true
}
```

### é’‰é’‰æœºå™¨äººé…ç½®
```json
{
    "type": "dingtalk",
    "webhook_url": "https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN",
    "enabled": true
}
```

### é‚®ä»¶å‘Šè­¦é…ç½®
```json
{
    "type": "email",
    "smtp_server": "smtp.gmail.com",
    "smtp_port": 587,
    "username": "your-email@gmail.com",
    "password": "your-password",
    "to_emails": ["admin@company.com"],
    "enabled": true
}
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### ç³»ç»ŸæŒ‡æ ‡
- **cpu**: CPUä½¿ç”¨ç‡ç™¾åˆ†æ¯” (0-100%)
- **memory**: å†…å­˜ä½¿ç”¨ç‡ç™¾åˆ†æ¯” (0-100%)
- **disk**: ç£ç›˜ä½¿ç”¨ç‡ç™¾åˆ†æ¯” (0-100%)

### æŒ‡æ ‡æ ¼å¼
```json
{
    "timestamp": 1704067200,
    "metrics": {
        "cpu": 45.2,
        "memory": 67.8,
        "disk": 23.1
    }
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### é…ç½®å»ºè®®
- **ç›‘æ§é—´éš”**: ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸º 30-60 ç§’
- **æ•°æ®ä¿ç•™**: æ ¹æ®å­˜å‚¨å®¹é‡è°ƒæ•´ä¿ç•™å¤©æ•°
- **å‘Šè­¦å†·å´**: é¿å…é¢‘ç¹å‘Šè­¦ï¼Œå»ºè®® 5-10 åˆ†é’Ÿ

### èµ„æºä½¿ç”¨
- **CPU**: é€šå¸¸ < 1%
- **å†…å­˜**: çº¦ 50-100MB
- **ç½‘ç»œ**: æ ¹æ®ç›‘æ§é¢‘ç‡å’Œå‘Šè­¦é¢‘ç‡è€Œå®š

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æ— æ³•è¿æ¥Redis**
   ```bash
   # æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
   redis-cli ping
   
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   telnet localhost 6379
   ```

2. **é…ç½®åŒæ­¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç®¡ç†ç«¯æœåŠ¡çŠ¶æ€
   curl http://your-admin-server:8000/health
   
   # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
   ping your-admin-server
   ```

3. **å‘Šè­¦å‘é€å¤±è´¥**
   ```bash
   # æ£€æŸ¥å‘Šè­¦é…ç½®
   # éªŒè¯webhook URLæœ‰æ•ˆæ€§
   # æ£€æŸ¥ç½‘ç»œé˜²ç«å¢™è®¾ç½®
   ```

### æ—¥å¿—æŸ¥çœ‹
```bash
# Dockerç¯å¢ƒ
docker-compose logs targetvpc

# æœ¬åœ°ç¯å¢ƒ
# æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå»ºè®®é‡å®šå‘åˆ°æ–‡ä»¶
python -m src.main > targetvpc.log 2>&1
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•
```bash
python test_targetvpc.py
```

### æ‰‹åŠ¨æµ‹è¯•API
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8001/health

# è·å–é…ç½®
curl -H "X-Client-IP: 127.0.0.1" http://localhost:8001/api/config

# æŸ¥è¯¢æŒ‡æ ‡
curl -X POST http://localhost:8001/api/metrics \
  -H "Content-Type: application/json" \
  -d '{"start_time":"2024-01-01T00:00:00Z","end_time":"2024-01-01T23:59:59Z","indexes":["cpu"]}'
```

## ğŸ“ˆ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ç›‘æ§æŒ‡æ ‡
1. åœ¨ `src/metrics/collector.py` ä¸­æ·»åŠ æ–°çš„æ”¶é›†æ–¹æ³•
2. åœ¨ `collect_all_metrics()` æ–¹æ³•ä¸­é›†æˆæ–°æŒ‡æ ‡
3. æ›´æ–°é…ç½®ä¸­çš„é˜ˆå€¼è®¾ç½®

### æ·»åŠ æ–°çš„å‘Šè­¦é€šé“
1. åœ¨ `src/alerts/handlers/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å¤„ç†å™¨
2. å®ç° `send_alert()` æ–¹æ³•
3. åœ¨ `AlertSender` ä¸­æ³¨å†Œæ–°çš„å¤„ç†å™¨

### è‡ªå®šä¹‰å­˜å‚¨åç«¯
1. ç»§æ‰¿ `Storage` åŸºç±»
2. å®ç°å¿…è¦çš„æ–¹æ³•
3. æ›´æ–°é…ç½®ä»¥ä½¿ç”¨æ–°çš„å­˜å‚¨åç«¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: guo.ling
- é‚®ç®±: guo.ling@outlook.com
- é¡¹ç›®åœ°å€: [https://github.com/AllfreedomAll/targetvpc]

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®çš„æ”¯æŒï¼š
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£ã€å¿«é€Ÿçš„Webæ¡†æ¶
- [psutil](https://github.com/giampaolo/psutil) - è·¨å¹³å°ç³»ç»Ÿç›‘æ§åº“
- [Redis](https://redis.io/) - é«˜æ€§èƒ½å†…å­˜æ•°æ®åº“
- [Uvicorn](https://www.uvicorn.org/) - è½»é‡çº§ASGIæœåŠ¡å™¨

---

**æ³¨æ„**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿ï¼š
- ä¿®æ”¹é»˜è®¤å¯†ç å’Œæ•æ„Ÿé…ç½®
- é…ç½®é€‚å½“çš„é˜²ç«å¢™è§„åˆ™
- è®¾ç½®ç›‘æ§å’Œå‘Šè­¦é˜ˆå€¼
- å®šæœŸå¤‡ä»½é…ç½®å’Œæ•°æ® 
